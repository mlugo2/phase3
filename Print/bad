COPY    START
FIRST   STL     RETADR		SAVE RETURN ADDRESS
CLOOP   JSUB    RDRECss		READ INPUT RECORD

EOF     BYTE    C'EO&F'
THREE   WORD    3
ZERO    WORD    0
RETADR  RESW    1
LENGTH  RESW    1		LENGTH OF RECORD
BUFFER  RESB    4096		4096-BYTE BUFFER AREA
.
.	SUBROUTINE TO READ RECORD INTO BUFFER
.
RDREC   LDX     ZERO		CLEAR LOOP COUNTER
	LDA     ZERO		CLEAR A TO ZERO
RLOOPSS   TD      INPUT		TEST INPUT DEVICE
	JEQ     RLOOP		LOOP UNTIL READY
	RD      INPUT		READ CHARACTER INTO REGISTAR A
	COMP    ZERO		TEST FOR END OF RECORD (X'00')
	JEQ     EXIT		EXIT LOOP IF EOF
	STCH    BUFFER,X	STORE CHARCTER IN BUFFER
	TIX     MAXLEN		LOOP UNLESS MAX LENGTH
	JLT     OOP	  	  HAS BEEN REACHED
EXIT    STX     LENGTH		SAVE RECORD LENGTH
	RSUB                    RETURN TO CALLER
INPUT   BYTE    X'F1'		CODE FOR INPUT DEVICE
MAXLEN	WORD	4096
.
.	SUBROUTINE TO WRITE RECORD FROM BUFFER
.
WRREC   LDX    ZERO		CLEAR LOOP COUNTER
WLOOP   TD     OUTPUT		TEST OUTPUT DEVICE
	JEQ    WLOOP		LOOP UNTIL READY
	LDCH   BUFFER,SD	        GET CHARCTER FROM BUFFER
	WD     OUTPUT		WRITE CHARACTER
	TIX    LENGTH		LOOP UNTIL ALL CHARACTERS
	JLT    WLOOP	  	  HAVE BEEN WRITTEN
	RSUB                    RETURN TO CALLER
OUTPUT  BYTE   X'05'		CODE FOR OUTPUT DEVICE
	
